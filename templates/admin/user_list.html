{% extends 'admin/dashboard.html' %}

{% block title %}{{ _('Users') }} | Admin{% endblock %}

{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">{{ _('Users') }}</h1>
  <a href="{{ url_for('admin.user_create', lang=lang) }}" class="btn btn-success">
    <i class="bi bi-person-plus"></i> {{ _('Create User') }}
  </a>
</div>

<form method="get" class="row g-2 align-items-center mb-3">
  <div class="col-sm-6 col-lg-4">
    <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="{{ _('Search by name, username, or email') }}">
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-outline-secondary">{{ _('Search') }}</button>
  </div>
  {% if q %}
  <div class="col-auto">
    <a class="btn btn-link" href="{{ url_for('admin.user_list', lang=lang) }}">{{ _('Clear') }}</a>
  </div>
  {% endif %}
</form>

<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>{{ _('ID') }}</th>
        <th>{{ _('Username') }}</th>
        <th>{{ _('Email') }}</th>
        <th>{{ _('Full name') }}</th>
        <th>{{ _('Phone') }}</th>
        <th>{{ _('Role') }}</th>
        <th>{{ _('Created') }}</th>
        <th>{{ _('Updated') }}</th>
        <th>{{ _('Actions') }}</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      {% set role_label = role_labels.get(user.role, user.role.title()) %}
      <tr>
        <td>{{ user.id }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.fullname or _('Not provided') }}</td>
        <td>{{ user.phone or _('Not provided') }}</td>
        <td>
          <span class="badge bg-{{ 'success' if user.role == 'admin' else 'primary' if user.role == 'course_owner' else 'secondary' }}">{{ role_label }}</span>
        </td>
        <td>{{ user.created_at }}</td>
        <td>{{ user.updated_at }}</td>
        <td class="d-flex gap-2">
          <a href="{{ url_for('admin.user_edit', lang=lang, user_id=user.id) }}" class="btn btn-sm btn-outline-primary">{{ _('Edit') }}</a>
          {% if user.role != 'admin' and user.id != current_user_id %}
          <form method="post" action="{{ url_for('admin.user_delete', lang=lang, user_id=user.id) }}" onsubmit="return confirm('{{ _('Are you sure you want to delete this user?') }}');">
            <button type="submit" class="btn btn-sm btn-outline-danger">{{ _('Delete') }}</button>
          </form>
          {% else %}
          <button type="button" class="btn btn-sm btn-outline-secondary" disabled>{{ _('Delete') }}</button>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="9" class="text-center text-muted py-4">{{ _('No users found.') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% set endpoint = 'admin.user_list' %}
{% set args = filters %}
{% include 'admin/_pagination.html' %}
{% endblock %}
